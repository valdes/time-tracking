<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Time Tracker</title>
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const TimeTracker = () => {
      const tasks = ['Work', 'Startup', 'Fitness', 'Leisure', 'Other'];
      const [currentTask, setCurrentTask] = useState(null);
      const [taskTimes, setTaskTimes] = useState({});
      const [startTime, setStartTime] = useState(null);
      const [currentTime, setCurrentTime] = useState(Date.now());

      useEffect(() => {
        const storedTimes = JSON.parse(localStorage.getItem('taskTimes')) || {};
        setTaskTimes(storedTimes);
      }, []);

      useEffect(() => {
        localStorage.setItem('taskTimes', JSON.stringify(taskTimes));
      }, [taskTimes]);

      useEffect(() => {
        if (currentTask) {
          const interval = setInterval(() => {
            setCurrentTime(Date.now());
          }, 1000);
          return () => clearInterval(interval);
        }
      }, [currentTask]);

      const startTimer = (task) => {
        if (currentTask) {
          stopTimer(currentTask);
        }
        setCurrentTask(task);
        let date = new Date();
        setStartTime(date);
        setCurrentTime(date);
      };

      const stopTimer = (task) => {
        if (!startTime) return;

        const elapsed = Date.now() - startTime;
        const today = new Date().toISOString().slice(0, 10);
        const taskKey = `${task}_${today}`;

        setTaskTimes((prev) => {
          const previousTime = prev[taskKey]?.totalTime || 0;
          const sessionLog = prev[taskKey]?.sessions || [];
          const newEntry = {
            totalTime: previousTime + elapsed,
            lastStart: new Date(startTime).toLocaleString(),
            lastEnd: new Date().toLocaleString(),
            sessions: [
              ...sessionLog,
              {
                start: new Date(startTime).toISOString(),
                end: new Date().toISOString(),
              },
            ],
          };
          return { ...prev, [taskKey]: newEntry };
        });

        setStartTime(null);
      };

      const handleTaskClick = (task) => {
        if (currentTask === task) {
          stopTimer(task);
          setCurrentTask(null);
        } else {
          startTimer(task);
        }
      };

      const formatTime = (ms) => {
        const seconds = Math.floor(ms / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        return `${hours}h ${minutes % 60}m ${seconds % 60}s`;
      };

      const today = new Date().toISOString().slice(0, 10);

      return (
        <div style={{ padding: '20px', fontFamily: 'Arial, sans-serif' }}>
          <h1>Time Tracker</h1>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
            {tasks.map((task) => {
              const taskKey = `${task}_${today}`;
              const totalTime = taskTimes[taskKey]?.totalTime || 0;
              const elapsedTime = currentTask === task && startTime ? currentTime - startTime : 0;
              const currentSessionTime = currentTask === task && startTime ? formatTime(elapsedTime) : null;
              return (
                <button
                  key={task}
                  onClick={() => handleTaskClick(task)}
                  style={{
                    padding: '10px 20px',
                    backgroundColor: currentTask === task ? 'green' : 'gray',
                    color: 'white',
                    border: 'none',
                    borderRadius: '5px',
                    cursor: 'pointer',
                    textAlign: 'left',
                  }}
                >
                  <div>{task}</div>
                  <div style={{ fontSize: '1.2em', marginTop: '5px' }}>‚è±Ô∏è: {formatTime(totalTime)}</div>
                  {currentSessionTime && (
                    <div style={{ fontSize: '1.2em', color: 'yellow' }}>üî• Active: {currentSessionTime}</div>
                  )}
                </button>
              );
            })}
          </div>
          {Object.keys(taskTimes).map((taskKey) => {
            const [taskName, date] = taskKey.split('_');
            if (date !== today) return null;
            const sessions = (taskTimes[taskKey]?.sessions || []).sort((a, b) => new Date(b.start) - new Date(a.start));
            return (
              <div key={taskKey} style={{ marginTop: '20px' }}>
                <h3>{taskName} - {date}</h3>
                <ul style={{ listStyleType: 'none', padding: 0 }}>
                  {sessions.map((session, index) => {
                    const start = new Date(session.start);
                    const end = new Date(session.end);
                    const length = end - start;
                    return (
                      <li key={index} style={{ marginBottom: '5px', padding: '5px', border: '1px solid #ccc', borderRadius: '5px' }}>
                        <span style={{ fontWeight: 'bold' }}>{formatTime(length)}</span> 
                        <span style={{ color: '#555' }}>({start.toLocaleTimeString()} - {end.toLocaleTimeString()})</span>
                      </li>
                    );
                  })}
                </ul>
              </div>
            );
          })}
          {currentTask && (
            <div style={{ marginTop: '20px' }}>
              <p>Tracking: {currentTask}</p>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<TimeTracker />, document.getElementById('root'));
  </script>
</body>
</html>
